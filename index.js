"use strict";var RevengeStalker=(()=>{var v=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var h=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var q=(e,t)=>{for(var r in t)v(e,r,{get:t[r],enumerable:!0})},j=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of H(t))!W.call(e,s)&&s!==r&&v(e,s,{get:()=>t[s],enumerable:!(n=G(t,s))||n.enumerable});return e};var K=e=>j(v({},"__esModule",{value:!0}),e);var ae={};q(ae,{default:()=>se});var i=h("@vendetta/metro"),o=h("@vendetta/plugin"),Q=h("@vendetta/metro/common");var u=h("@vendetta/plugin");function $(e){let t=u.storage.whitelistedIds?u.storage.whitelistedIds.split(","):[];t.push(e),u.storage.whitelistedIds=t.join(",")}function R(e){let t=u.storage.whitelistedIds?u.storage.whitelistedIds.split(","):[],r=t.indexOf(e);r!==-1&&t.splice(r,1),u.storage.whitelistedIds=t.join(",")}function f(e){return(u.storage.whitelistedIds?u.storage.whitelistedIds.split(","):[]).indexOf(e)!==-1}function C(e){return!Array.isArray(e)&&(typeof e!="object"||e===null)?e:Array.isArray(e)?e.map(C):Object.keys(e).reduce((t,r)=>{let n=r.replace(/_([a-z])/gi,(c,I)=>I.toUpperCase()),s=C(e[r]);return{...t,[n]:s}},{})}function b(e){if(!u.storage.showMessageBody)return"Click to jump to the message";let{charLimit:t}=u.storage,{content:r,attachments:n}=e.message,s=r||n?.[0]?.filename||"Click to jump to the message";return t>0&&s.length>t?`${s.substring(0,t)}...`:s}var l={info:e=>console.log(`[RevengeStalker] ${e}`),error:e=>console.error(`[RevengeStalker] ${e}`),warn:e=>console.warn(`[RevengeStalker] ${e}`)};var P=h("@vendetta/metro/common"),a=h("@vendetta/plugin"),E=h("@vendetta/storage"),m=h("@vendetta/ui/components"),g=h("react/jsx-runtime"),{View:J,ScrollView:Y}=P.ReactNative;function k(){return(0,E.useProxy)(a.storage),(0,g.jsx)(Y,{children:(0,g.jsxs)(J,{children:[(0,g.jsx)(m.Forms.FormInput,{label:"Whitelisted User IDs",value:a.storage.whitelistedIds??"",onChange:e=>a.storage.whitelistedIds=e,placeholder:"Enter user IDs separated by commas",note:"User IDs to stalk (separated by commas)"}),(0,g.jsx)(m.Forms.FormSwitchRow,{label:"Track user profile changes",value:a.storage.trackUserProfileChanges??!0,onValueChange:e=>a.storage.trackUserProfileChanges=e,note:"Show notification for 'user profile changed'"}),(0,g.jsx)(m.Forms.FormSwitchRow,{label:"Track typing indicators",value:a.storage.trackStartedTyping??!0,onValueChange:e=>a.storage.trackStartedTyping=e,note:"Show notification for 'user started typing'"}),(0,g.jsx)(m.Forms.FormSwitchRow,{label:"Track sent messages",value:a.storage.trackSentMessage??!0,onValueChange:e=>a.storage.trackSentMessage=e,note:"Show notification for 'user sent a message'"}),(0,g.jsx)(m.Forms.FormSwitchRow,{label:"Show message contents",value:a.storage.showMessageBody??!1,onValueChange:e=>a.storage.showMessageBody=e,note:"Include message contents in notification"}),(0,g.jsx)(m.Forms.FormInput,{label:"Character limit",value:a.storage.charLimit?.toString()??"100",onChange:e=>a.storage.charLimit=parseInt(e)||100,placeholder:"100",note:"Character limit for notifications. Set to 0 for no limit"}),(0,g.jsx)(m.Forms.FormSelect,{label:"Notification Type",value:a.storage.notificationType??"toast",onValueChange:e=>a.storage.notificationType=e,options:[{label:"Toast Notifications",value:"toast"},{label:"Alert Dialogs",value:"alert"},{label:"Console Only",value:"console"},{label:"All Methods",value:"all"}],note:"Choose how you want to receive notifications"})]})})}var _;(_=o.storage).whitelistedIds??(_.whitelistedIds="");var y;(y=o.storage).trackUserProfileChanges??(y.trackUserProfileChanges=!0);var L;(L=o.storage).trackStartedTyping??(L.trackStartedTyping=!0);var N;(N=o.storage).trackSentMessage??(N.trackSentMessage=!0);var x;(x=o.storage).showMessageBody??(x.showMessageBody=!1);var F;(F=o.storage).charLimit??(F.charLimit=100);var O;(O=o.storage).notificationType??(O.notificationType="toast");var d={},X={},T=(e,t,r)=>{try{let n=(0,i.findByProps)("pushLazy","pop","push");n&&(e&&t?n.pushLazy({screen:"Channel",params:{guildId:e,channelId:t,messageId:r}}):t&&n.pushLazy({screen:"Channel",params:{channelId:t,messageId:r}}))}catch(n){l.error(`Failed to navigate: ${n}`)}},S=(e,t,r,n)=>{let s=o.storage.notificationType||"toast";if(l.info(`${e}: ${t}`),(s==="console"||s==="all")&&console.log(`[RevengeStalker] ${e}: ${t}`),s==="alert"||s==="all")try{let c=(0,i.findByProps)("alert");c?c.alert(e,t,[{text:"Cancel",style:"cancel"},{text:"View",onPress:r}]):alert(`${e}

${t}`)}catch{alert(`${e}

${t}`)}if(s==="toast"||s==="all")try{let c=(0,i.findByProps)("show","SHORT","LONG");c?c.show(`${e}: ${t}`,c.SHORT):console.log(`[TOAST] ${e}: ${t}`)}catch{console.log(`[TOAST] ${e}: ${t}`)}},D=(e,t="SUCCESS")=>{let r=o.storage.notificationType||"toast";if(r==="toast"||r==="all")try{let n=(0,i.findByProps)("show","SHORT","LONG");n?n.show(e,n.SHORT):console.log(`[TOAST] ${t}: ${e}`)}catch{console.log(`[TOAST] ${t}: ${e}`)}if(r==="alert"||r==="all")try{let n=(0,i.findByProps)("alert");n?n.alert("RevengeStalker",e):alert(e)}catch{alert(e)}l.info(`${t}: ${e}`)},Z=e=>{try{let t=(0,i.findByProps)("pushLazy","pop","push");t&&t.pushLazy({screen:"UserProfile",params:{userId:e}})}catch(t){l.error(`Failed to open user profile: ${t}`)}},p=()=>{try{let e=(0,i.findByStoreName)("ChannelStore");return e?e.getChannel():null}catch{return null}},w=e=>{try{let t=(0,i.findByStoreName)("UserStore");return t?t.getUser(e):null}catch{return null}},ee=(e,t)=>{try{let r=(0,i.findByStoreName)("MessageStore");return r?r.getMessage(e,t):null}catch{return null}},te=e=>{try{let t=(0,i.findByStoreName)("ChannelStore");return t?t.getChannel(e):null}catch{return null}},V=async(e,t={})=>{try{let r=(0,i.findByProps)("get","post","put","delete");return r?await r.get({url:e,...t}):(l.error("RestAPI not found"),null)}catch(r){return l.error(`API request failed: ${r}`),null}},M={MESSAGE_CREATE:e=>{if(!e.message||!e.message.author||!e.message.channel_id||!o.storage.trackSentMessage)return;let t=e.message.author?.id;if(!f(t)||p()?.id===e.channelId)return;let r=w(t);if(r){if(e.message.type===7){S(`${r.globalName||r.username} Joined a server`,"Tap to jump to the message.",()=>T(e.guildId,e.channelId,e.message.id),r.getAvatarURL?.(void 0,void 0,!1));return}S(`${r.globalName||r.username} Sent a message`,b(e),()=>T(e.guildId,e.channelId,e.message.id),r.getAvatarURL?.(void 0,void 0,!1))}},MESSAGE_UPDATE:e=>{if(!e.message||!e.message.author||!e.message.channel_id)return;let t=e.message.author?.id;if(!f(t)||p()?.id===e.message.channel_id)return;let r=w(t);r&&S(`${r.globalName||r.username} Edited a message`,b(e),()=>T(e.guildId,e.message.channel_id,e.message.id),r.getAvatarURL?.(void 0,void 0,!1))},MESSAGE_DELETE:async e=>{if(!e||!e?.channelId||!e?.id||!e?.guildId)return;let t=ee(e.channelId,e.id)??X[e.id];if(!t){l.error("Received a MESSAGE_DELETE event but the message was not found in the MessageStore");return}let{author:r}=t;!f(r?.id)||p()?.id===t.channel_id||S(`${r.globalName||r.username} Deleted a message!`,`"${t.content.length>100?t.content.substring(0,100).concat("..."):t.content}"`,()=>{T(e.guildId,t.channel_id,t.id)},r.getAvatarURL?.(void 0,void 0,!1))},TYPING_START:e=>{if(!e||!e.channelId||!e.userId||!o.storage.trackStartedTyping)return;let t=w(e.userId);!f(t?.id)||p()?.id===e.channelId||S(`${t.globalName||t.username} Started typing...`,"Tap to jump to the channel.",()=>{let r=te(e.channelId);r&&T(r.guild_id,e.channelId)},t.getAvatarURL?.(void 0,void 0,!1))},USER_PROFILE_FETCH_SUCCESS:async e=>{if(!e||!e.user||!e.user.id||!f(e.user.id)||!o.storage.trackUserProfileChanges)return;e=C(e);let t=d[e.user.id]?C(d[e.user.id]):null;if(!t){d[e.user.id]=e;return}let r=(()=>{let I=["username","globalName","avatar","discriminator","clan","flags","banner","banner_color","accent_color","bio"],A=[];return I.forEach(U=>{let z=e.user[U],B=t.user[U];z!==B&&A.push(U)}),A})();if(r.length===0)return;let n=e.user.globalName||e.user.username,s=r.join(", "),c=w(e.user.id)?.getAvatarURL?.(void 0,void 0,!1);S(`${n} updated their profile!`,`Updated properties: ${s}.`,()=>Z(e.user.id),c),d[e.user.id]=e},THREAD_CREATE:e=>{if(!(!e||!e.channel||!e.channel.id||!e.channel.ownerId||!f(e.channel.ownerId))&&e.isNewlyCreated){let t=w(e.channel.ownerId);if(!t)return;S(`New thread created by ${t.globalName||t.username}`,"Tap to view the thread.",()=>T(e.channel.guild_id,e.channel.parent_id),t.getAvatarURL?.(void 0,void 0,!1))}}};var re=async e=>{let t=w(e);if(!t)return;D(`Stalking ${t.globalName||t.username}`),$(e);let r=await V(`/users/${e}/profile`,{query:{with_mutual_guilds:!0,with_mutual_friends_count:!0}});r?.body&&(d[e]=C(r.body),l.info(`Cached user ${e} with name ${d[e].user.globalName||d[e].user.username} for further usage.`))},ne=e=>{let t=w(e);t&&(D(`Stopped stalking ${t.globalName||t.username}`),R(e),delete d[e])},se={onLoad:()=>{l.info("RevengeStalker plugin loaded"),(async()=>{for(let r of o.storage.whitelistedIds.split(",")){if(!r.trim())continue;let n=await V(`/users/${r}/profile`,{query:{with_mutual_guilds:!0,with_mutual_friends_count:!0}});n?.body&&(d[r]=n.body,l.info(`Cached user ${r} with name ${d[r].user.globalName||d[r].user.username} for further usage.`))}})();let t=(0,i.findByProps)("dispatch","subscribe");t&&Object.entries(M).forEach(([r,n])=>{t.subscribe(r,n)})},onUnload:()=>{l.info("RevengeStalker plugin unloaded");let e=(0,i.findByProps)("dispatch","subscribe");e&&Object.entries(M).forEach(([t,r])=>{e.unsubscribe(t,r)})},settings:k,stalkUser:re,unStalkUser:ne,isInWhitelist:f,addToWhitelist:$,removeFromWhitelist:R};return K(ae);})();
